<%- include("templates/header.ejs", {titulo: "Mis Compartidos"}) %>
<div class="container mt-4">
    
    <h2 class="mb-4 text-center">Centro de Compartidos</h2>

    <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" id="recibidos-tab" data-bs-toggle="tab" data-bs-target="#recibidos" type="button">Recibidos</button>
        </li>
        <li class="nav-item">
            <button class="nav-link" id="enviados-tab" data-bs-toggle="tab" data-bs-target="#enviados" type="button">Enviados</button>
        </li>
    </ul>

    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="recibidos">
            <div class="row">
                <% if(recibidos.length === 0) { %> 
                    <div class="col-12 text-center text-muted">No te han compartido nada aún.</div> 
                <% } %>
                <% recibidos.forEach(item => { %>
                   <div class="col-md-4 mb-3">
                       <div class="card border-primary h-100 shadow-sm">
                           <div class="card-body">
                               <h5 class="card-title text-primary">
                                   <%= item.articulo ? item.articulo.nombre : 'Artículo eliminado' %>
                               </h5>
                               <p class="card-text">
                                   <strong>De:</strong> <%= item.emisor ? item.emisor.usuario : 'Desconocido' %><br>
                                   <small class="text-muted"><%= new Date(item.fecha).toLocaleDateString() %></small>
                               </p>
                               <% if (item.articulo && item.articulo.imagen) { %>
                                    <img src="/images/<%= item.articulo.imagen %>" class="img-fluid rounded mt-2" style="max-height: 150px;">
                               <% } %>
                           </div>
                       </div>
                   </div> 
                <% }) %>
            </div>
        </div>

        <div class="tab-pane fade" id="enviados">
            <div class="row">
                <% if(enviados.length === 0) { %> 
                    <div class="col-12 text-center text-muted">No has compartido nada aún.</div> 
                <% } %>
                <% enviados.forEach(item => { %>
                   <div class="col-md-4 mb-3">
                       <div class="card border-success h-100 shadow-sm">
                           <div class="card-body">
                               <h5 class="card-title text-success">
                                   <%= item.articulo ? item.articulo.nombre : 'Artículo eliminado' %>
                               </h5>
                               <p class="card-text">
                                   <strong>Para:</strong> <%= item.receptor ? item.receptor.usuario : 'Desconocido' %><br>
                                   <small class="text-muted"><%= new Date(item.fecha).toLocaleDateString() %></small>
                               </p>
                           </div>
                       </div>
                   </div> 
                <% }) %>
            </div>
        </div>
    </div>
</div>

<script>
    var triggerTabList = [].slice.call(document.querySelectorAll('#myTab button'))
    triggerTabList.forEach(function (triggerEl) {
      var tabTrigger = new bootstrap.Tab(triggerEl)
      triggerEl.addEventListener('click', function (event) {
        event.preventDefault()
        tabTrigger.show()
      })
    })
</script>

<%- include("templates/footer.ejs") %>